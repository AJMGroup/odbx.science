{% extends "layout.html" %}
    
{% block head %}
{% endblock %}

{% block content %}

<meta http-equiv="X-UA-Compatible" content="chrome=1">
<link rel="stylesheet" href=" {{ url_for('js', path='./lib/ChemDoodleWeb-8.0.0/install/ChemDoodleWeb.css') }}" type="text/css">
<script src=" {{ url_for('js', path='./lib/ChemDoodleWeb-8.0.0/install/ChemDoodleWeb.js') }}", type="text/javascript"> </script>

<div class="structure_header">
    <h1><span class="header_text"><span class="formula_title">{{ structure_info['data']['attributes']['chemical_formula_descriptive'] }}:</span><span class="odbx_id">{{ structure_info['data']['id'] }}</span></span></h1>
</div>

<div class="columns"> 
    <div class="deck" id="crystal_info">
        <table class="crystal_table">
            <tr>
                <th> # of atoms</br></th>
            </tr>
            <tr>
                <td> 8 </td>
            </tr>
            <!--<tr>-->
                <!--<th> Number of formula units</br>per unit cell</th>-->
            <!--</tr>-->
            <!--<tr>-->
                <!--<td> 1 {{ structure_info['data']['attributes']['_odbx_num_formula_units'] }}</td>-->
            <!--</tr>-->
            <tr>
                <th> Space Group </th>
            </tr>
            <tr>
                <td> 
                    {{ structure_info['data']['attributes']['_odbx_space_group']['symbol'] }}</p>
                </td> </tr>
            <tr>
                <th> Cell Volume (Å³) </th>
            </tr>
            <tr>
                <td> 
                    {{ "{:4.3f}".format(structure_info['data']['attributes'].get('_odbx_cell_volume', 0.0)).replace('0.000', 'xxx') }}
                </td>
            </tr>
            <tr>
                <th> Lattice Vectors (Å) </th>
            </tr>
            <tr>
                <td> 
                    {% for vec in structure_info['data']['attributes']['lattice_vectors'] %}
                        {% for elem in vec %}
                        {{ "{:+4.3f}".format(elem).replace('+', '&nbsp;') | safe}}
                        {% endfor %}
                        </br>
                        {% endfor %}
                </td>
            </tr>
            <tr>
                <th> Cell Contents </th>
            </tr>
            <tr>
                <td> 
                    {% for atom in structure_info['data']['attributes']['species_at_sites'] %}
                        {{ "{:3}".format(atom)}}
                        {% for elem in structure_info['data']['attributes']['cartesian_site_positions'][loop.index-1] %}
                            {{ "{:+4.3f}".format(elem).replace('+', '&nbsp;') | safe}}
                        {% endfor %}
                        </br>
                    {% endfor %}
                </td>
            </tr>
        </table>
    </div>

    <div class="deck" id="info">
        <table class="energy_table">
            <tr>
                <th> Formation energy </th>
            </tr>
            <tr>
                <td>
                    {{ "{}".format(structure_info['data']['attributes']['_odbx_thermodynamics'].get('formation_energy')) }} eV/atom
                </td>
            </tr>
            <tr>
                <th> Enthalpy </th>
            </tr>
            <tr>
                <td>
                    {{ "{:4.4f}".format(structure_info['data']['attributes']['_odbx_thermodynamics'].get('enthalpy')) }} eV/atom
                </td>
            </tr>
        </table>
        <table class="dft_table">
            <tr>
                <th> Code Version </th>
            </tr>
                <td>
                    {{ structure_info['data']['attributes'].get('_odbx_dft_code', {}).get('_odbx_code_name', 'CASTEP 20.1 +abdfx8') }}
                </td>
            </tr>
            <tr>
                <th> xc-functional </th>
            </tr>
            <tr>
                <td>
                    {{ structure_info['data']['attributes'].get('_odbx_dft_parameters', {}).get('_odbx_xc_functional', 'PBE') }}
                </td>
            </tr>
            <tr>
                <th> Cutoff energy </th>
            </tr>
            <tr>
                <td>
                    {{ "{:4.0f}".format(structure_info['data']['attributes'].get('_odbx_dft_parameters', {}).get('_odbx_cutoff_energy', 800.0)) }} eV
                </td>
            </tr>
        </table>
    </div>

    <!-- Viewer -->
    <div class="deck" id="viewer" 
         data-cif="{{ odbx_cif_string }}" 
         canvas-x="350" canvas-y="350">
        <script src=" {{ url_for('js', path='./chemdoodle_viewer.js') }}" type="text/javascript"></script>
    </div>
</div>

{% endblock content %}
